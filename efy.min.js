export let efy_version="25.01.27 Beta",$=document.querySelector.bind(document),$all=document.querySelectorAll.bind(document),$head,$body,$root,$efy_module,efy={},efy_lang={},efy_audio={volume:1},$save=()=>{},$100vh,open_idb,efy_css={},$add=(e,t={},a=[],s=document.body,o="beforeend")=>{const i=document.createElement(e);if("string"==typeof t||Array.isArray(t)){if(s!==document.body){const e=typeof s;"string"===e&&(o=s),["string","object"].includes(e)&&(s=a)}[a,t]=[t,{}]}return Object.entries(t).forEach((e=>i.setAttribute(...e))),Array.isArray(a)||(a=[a]),a.forEach((e=>{if(Array.isArray(e)){let[t,a,s]=e;("string"==typeof a||Array.isArray(a))&&([s,a]=[a,{}]),i.appendChild($add(t,a,s,i))}else"string"==typeof e?i.textContent+=e:e instanceof Node&&i.appendChild(e)})),s.insertAdjacentElement(o,i),i},$text=(e,t,a)=>{a?e.insertAdjacentText(a,t):e.textContent=t},$css_prop=(e,t,a=$root)=>{if(!t){let t=getComputedStyle(a).getPropertyValue(e);return t.startsWith(" ")&&(t=t.slice(0,1)),t}a.style.setProperty(e,t)},$event=(e,t,a,s)=>{s?e.addEventListener(t,a,s):e.addEventListener(t,a)},$event_rm=(e,t,a,s)=>{s?e.removeEventListener(t,a,s):e.removeEventListener(t,a)},$ready=(e,t,a)=>{let s=document.documentElement;if(1==a)return new Promise((t=>{let a=$(e);a?t(a):new MutationObserver(((a,s)=>{Array.from($all(e)).forEach((e=>{t(e),s.disconnect()}))})).observe(s,{childList:!0,subtree:!0})})).then((()=>t(e.selector)));{let a,o=[{sel:e,fn:t}],i=()=>{for(let{sel:e,fn:t}of o){let a=Array.from($all(e));for(let e of a)e.$ready||(e.$ready=!0,t(e,e))}};a||(a=new MutationObserver(i).observe(s,{childList:!0,subtree:!0})),i()}},cursor_fn=e=>{let t=$("[efy_cursor]");t.style.left=e.pageX+"px",t.style.top=e.pageY+"px"},$audio_play=async(e,t)=>{try{document.hasFocus()&&(e.pause(),e.currentTime=0,e.play(),"loop"==t&&$event(e,"ended",(()=>{e.pause(),e.currentTime=0,e.play()}),!1))}catch(e){}},$wait=(e,t)=>setTimeout(t,1e3*e),$$=(e,t)=>e.querySelector(t),$$all=(e,t)=>e.querySelectorAll(t),$notify=(e,t,a,s,o,i)=>{let n=[];const r={short:5,long:30,infinite:600},l=Date.now(),_="alert"+l,c=$(".efy_quick_notify i");let d=e=void 0!==r[e]?r[e]:e;const f=()=>{let e=$all(".efy_quick_notify_content [efy_alert]").length>0?"notify_active":"notify";c.setAttribute("efy_icon",e)};"lang"==s&&(t=efy_lang[t],a=efy_lang[a]),o="string"==typeof o?["i",{efy_icon:o}]:null,["[efy_alerts]",".efy_quick_notify_content"].map((s=>{const i="[efy_alerts]"==s?["div",{class:"time_left"},String(e)]:"";n.push($add("div",{efy_alert:"",class:_},[["div",{class:"nav"},[["div",{class:"title"},[o,["p",t]]],["div",{class:"remove_timer"},[i,["button",{efy_btn_square:"",class:"remove"},[["i",{efy_icon:"remove"}]]]]]]],a?["p",{class:"info"},a]:null],$(s)))})),f(),efy.audio_status&&$audio_play(efy_audio.ok3),efy_timer_interval=setInterval((()=>{const t=$(`.${_} .time_left`);d=e-Math.floor((Date.now()-l)/1e3),t?t.textContent=d:clearInterval(efy_timer_interval)}),1e3),i&&i(n),$wait(e,(()=>{clearInterval(efy_timer_interval);try{$(`[efy_alerts] .${_}`).remove()}catch{}f()}))},$sec_time=e=>`${Math.floor(e/3600).toString().padStart(2,"0")}:${Math.floor(e%3600/60).toString().padStart(2,"0")}:${Math.floor(e%60).toString().padStart(2,"0")}`;window.onload=async()=>{let e,t;$root=$(":root"),$head=document.head,$body=document.body,efy.modules||(efy.modules=$css_prop("---modules").replaceAll(" ","").split(",")),$efy_module=e=>!!efy.modules.includes(e);try{localStorage.efy&&(efy=JSON.parse(localStorage.efy)),$save=()=>{localStorage.efy=JSON.stringify(efy)}}catch{$wait(2,(()=>{$add("div",{class:"efy_no_ls",efy_card:""},[["h6",{efy_lang:"localstorage_off"}],["p",{efy_lang:"localstorage_off_text"}]],$(".efy_sidebar > [efy_about]"),"afterend")}))}efy.folder=$css_prop("---folder"),null==efy.lang_code&&(efy.lang_code=$css_prop("---lang_code")),$add("link",{href:`${efy.folder}/lang/${efy.lang_code}.css`,rel:"stylesheet",efy_lang:""},[],$head),$add("link",{href:`${$css_prop("---lang_folder")}/${efy.lang_code}.css`,rel:"stylesheet",efy_lang:"",class:"efy_lang_app_file"},[],$head),$100vh=()=>{const e=efy.text_zoom||1;$css_prop("---100vh",(visualViewport.height*visualViewport.scale).toFixed(2)/e+"rem")},$100vh(),$event(window.visualViewport,"resize",$100vh),$event(window.visualViewport,"orientationchange",$100vh),$add("div",{id:"efy_sidebar",class:"efy_sidebar",efy_search:"details:not(.efy_quick_shortcuts, [efy_logo]), .efy_sidebar [efy_tabs] > *"},[["div",{efy_about:""},[["div",{class:"efy_flex efy_sidebar_top_buttons"},[["button",{class:"efy_about",efy_toggle:".efy_about_div",efy_logo:""},[["p","EFY"],["p"," UI"]]],["button",{class:"efy_quick_notify efy_square_btn",efy_toggle:".efy_quick_notify_content",title:"Notifications"},[["i",{efy_icon:"notify"}]]],["button",{class:"efy_quick_search efy_square_btn",efy_toggle:"#efy_sidebar [efy_search_input]",title:"Search"},[["i",{efy_icon:"search"}]]]]],["button",{efy_sidebar_btn:"close",class:"efy_square_btn",title:"close"},[["i",{efy_icon:"remove"}]]]]],["div",{efy_card:"",class:"efy_about_div efy_hide_i"},[["mark",{efy_lang:"version"},[`: ${efy_version}`]],["p",{efy_lang:"sidebar_about_text"}],["div",{class:"efy_flex"},[["a",{href:"https://efy.ooo",role:"button",efy_lang:"website"}],["a",{href:"https://github.com/dragos-efy/efy",role:"button"},"Github"],["a",{href:"https://matrix.to/#/#efy_ui:matrix.org",role:"button"},"Matrix"],["a",{href:"https://translate.codeberg.org/projects/efy",role:"button",efy_lang:"translations"}]]]]],["div",{id:"efy_modules"}],["details",{id:"efy_sbtheme",efy_select:""},[["summary",{efy_lang:"theme"},[["i",{efy_icon:"star"}]]],["div",{efy_tabs:"efy_theme"},[["div",{class:"efy_tabs"}]]]]],["details",{id:"efy_modules_menu",efy_select:""},[["summary",{efy_lang:"modules"},[["i",{efy_icon:"group"}]]],["div",{id:"efy_modules_menu_div"},[["div",{class:"efy_modules_menu_reload efy_hide_i",efy_card:""},[["p","Refresh the page to see the changes"],["button",{efy_lang:"reset",onClick:"location.reload();"},[["i",{efy_icon:"reload"}]]]]]]]]]]),$add("button",{efy_sidebar_btn:"absolute",title:"menu"},[["i",{efy_icon:"menu"}]]),$add("video",{class:"efy_3d_bg",autoplay:"",loop:"",muted:"",playsinline:""}),["quick","filters","backup","accessibility","languages","audio","virtual_keyboard","gamepads","click_effects"].map((e=>{const t=`efy_module_toggles_efy_${e}`,a=[[],$("#efy_modules_menu_div")];$add("input",{id:t,type:"checkbox",name:"efy_module_toggles"},...a),$add("label",{for:t,efy_lang:e},...a)})),efy.modules.map((e=>$(`#efy_module_toggles_${e}`).checked=!0)),$event($body,"change",(()=>{event.target.matches("#efy_modules_menu_div input")&&(efy.modules=Array.from($all("#efy_modules_menu_div input:checked")).map((e=>e.id.replace("efy_module_toggles_",""))),$save(),$(".efy_modules_menu_reload").classList.remove("efy_hide_i"))}));let a=$("[efy_about]");$add("input",{type:"text",efy_search_input:"",class:"efy_hide_i",tabindex:"-1",placeholder:"Search through menu...",name:"efy_name"},[],a,"afterend"),$add("div",{class:"efy_quick_notify_content efy_hide_i",efy_card:""},[],a,"afterend"),["mode","colors","size","menu"].map((e=>{const t=`efy_theme_${e}`,a=[[],$("[efy_tabs=efy_theme] .efy_tabs")],s=$add("input",{efy_tab:e,type:"radio",id:t,name:"efy_theme_tabs"},...a),o=$add("div",{efy_content:e,efy_select:"",id:`efy_${e}`},[],$("[efy_tabs=efy_theme]"));$add("label",{efy_lang:e,for:t},...a),"mode"==e&&(s.setAttribute("efy_active",""),o.setAttribute("efy_active",""))})),t=$("#efy_sbtheme [efy_content=colors]");let s=$css_prop("---color").split(", ");s.map(((e,t)=>s[t]=`${t+1} ${e}`));let o=efy.colors?String(efy.colors):s,i=$add("div",{id:"efy_gradient",efy_tabs:"container",efy_color:`${o}, range:1-18`},[],t);$add("div",{efy_lang:"angle",efy_range_text:"Angle"},[["input",{class:"efy_color_angle_input",type:"range",min:"0",max:"360",value:"165",step:"1"}]],t);const n=e=>{let[t,a,s,o,n]=[[],[],[],[],[]];const r=$$all(i,"[efy_content]");e||(e=$(".efy_color_angle_input").value+"deg"),r.forEach(((e,o)=>{t.push($$(e,".alpha").value);const i=`${$$(e,".lightness").value} ${$$(e,".chroma").value} ${$$(e,".hue").value}`;n.push(`${o+1} ${i} ${t[o]}`),a.push(`oklch(${i} / ${t[o]})`),s.push(`oklch(${i} / ${(t[o]/3).toFixed(2)})`)})),o=r.length>1?[a,s]:[`${a}, ${a}`,`${s}, ${s}`],efy.colors=n,$save(),["","_trans"].map(((t,a)=>$css_prop(`---color${t}`,`linear-gradient(${e}, ${o[a]})`)))};if(efy.colors){let e=[[],[]];const t=efy.color_angle||`${$(".efy_color_angle_input").value}deg`;efy.colors.forEach((t=>{t=t.split(" ");for(let a=0;a<2;a++)e[a].push(`oklch(${t[1]} ${t[2]} ${t[3]} / ${0===a?t[4]:(t[4]/3).toFixed(2)})`),efy.colors.length<2&&e[a].push(...e[a])})),["","_trans"].map(((a,s)=>$css_prop(`---color${a}`,`linear-gradient(${t}, ${e[s]})`)))}else $ready("#efy_gradient .alpha",n,1);$event($(".efy_color_angle_input"),"input",(()=>n())),$event(i,"input",(()=>n())),$event(i,"click",(e=>{const t=e.target;(t.matches(".color_add")||t.matches(".color_remove"))&&n()})),$add("div",{class:"efy_hr_div"},[["details",{efy_help:"custom_colors"},[["summary",[["p",{efy_lang:"custom_colors"}],["hr"]]],["div",{efy_lang:"custom_colors_help"}]]]],t),$add("div",{class:"efy_custom_colors",efy_color:"Text 0.5 0.2 0 1 efy_color_text, Background 0.7 0.2 100 1 efy_color_bgcol, Border 0.7 0.2 100 1 efy_color_bordercol, Button 0.7 0.2 100 1 efy_color_buttoncol"},[],t),$ready("[for=efy_color_buttoncol]",(()=>{["text","bgcol","bordercol","buttoncol"].map(((e,t)=>{const a=`efy_${e}_status`,s=[[],$(`.efy_custom_colors [efy_content="${t+1}"]`),"afterbegin"];$add("label",{for:a,efy_lang:"active"},...s),$add("input",{id:a,type:"checkbox"},...s),void 0!==efy[e]&&$css_prop(`---color_${e}_var`,efy[e])})),"text_status bgcol_status bordercol_status buttoncol_status".split(" ").forEach((e=>{efy[e]&&$(`#efy_${e}`).setAttribute("checked",""),$event($(`#efy_${e}`),"click",(()=>{efy[e]?delete efy[e]:efy[e]=!0,$save()}))})),efy.text_status&&$root.setAttribute("efy_color_text",""),$("#efy_text_status").onchange=()=>{$root.toggleAttribute("efy_color_text")},efy.bgcol_status&&$root.setAttribute("efy_color_bgcol",""),$("#efy_bgcol_status").onchange=()=>{$root.toggleAttribute("efy_color_bgcol")},efy.bordercol_status&&$root.setAttribute("efy_color_bordercol",""),$("#efy_bordercol_status").onchange=()=>{$root.toggleAttribute("efy_color_bordercol")},efy.buttoncol_status&&$root.setAttribute("efy_color_buttoncol",""),$("#efy_buttoncol_status").onchange=()=>{$root.toggleAttribute("efy_color_buttoncol")},$event($(".efy_custom_colors .efy_tabs"),"keydown",(e=>{const t=Array.from($all(".efy_custom_colors .efy_tabs .efy_tab input")),a=t.indexOf(document.activeElement);if("Tab"===e.key&&(e.shiftKey?t[0].focus():a!==t.length-1&&t[t.length-1].focus()),["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(e.key)){e.preventDefault();t[(a+(["ArrowRight","ArrowDown"].includes(e.key)?1:-1)+t.length)%t.length].focus()}}))}),1);const r=$add("div",{class:"efy_shadows"},[],t);let l=[];["button","trans"].map((e=>{const t=`shadow_${e}`,a=`.efy_shadows .efy_shadows_${e}`;let s=[];efy[t]&&(l.push(e),efy[t].map(((e,t)=>s.push(`${t+1} ${e.lightness} ${e.chroma} ${e.hue} ${e.alpha}`)))),$add("div",{class:"efy_hr_div"},[["p",`Shadows: ${e.charAt(0).toUpperCase()+e.slice(1)}`],["hr"]],r),$add("div",{class:`efy_shadows_${e}`,efy_color:(0===s.length?"":`${s}, `)+"range:0-10"},[],r),$ready(`${a} .alpha`,(()=>{const s=(a,s)=>{$css_prop(`---${t}`,a),"button"===e&&$css_prop(`---${t}_trans`,s)};if(efy[t]){let[e,o]=[[],[]];efy[t].map(((t,s)=>{const i=t,n=$(`${a} [efy_content="${s+1}"]`),[r,l,_,c]=[$$(n,".lightness"),$$(n,".chroma"),$$(n,".hue"),$$(n,".alpha")],d=[i.lightness,i.chroma,i.hue],f=`, oklch(${d})`;[[e,i.alpha],[o,(i.alpha/3).toFixed(2)]].map((e=>e[0].push(`${i.css} ${e[1]})`)))[(r.value,l.value,_.value,c.value)]=[...d,i.alpha],[[r,`oklch(0 0 0)${f}, #fff)`],[l,`oklch(0.5 0 0)${f})`],[c,`transparent${f})`]].forEach((e=>e[0].style.background=`linear-gradient(to right, ${e[1]}`))})),s(e,o)}$event($(a),"input",(()=>{if(event.target.matches("input")){let[o,i,n]=[[],[],[]];$all(`${a} [efy_content]`).forEach(((t,a)=>{const[s,r,l,_,c,d,f,y,u]=[$$(t,`#efy_shadow_${e}_inset${a}`).checked,$$(t,".x").value,$$(t,".y").value,$$(t,".blur").value,$$(t,".spread").value,$$(t,".lightness").value,$$(t,".chroma").value,$$(t,".hue").value,$$(t,".alpha").value],m=`${s?"inset ":""}${r}rem ${l}rem ${_}rem ${c}rem oklch(${d} ${f} ${y} /`;o.push({inset:s,x:r,y:l,blur:_,spread:c,lightness:d,chroma:f,hue:y,alpha:u,css:m}),[[i,u],[n,(u/3).toFixed(2)]].map((e=>e[0].push(`${m} ${e[1]})`)))})),s(i,n),efy[t]=o,$save(),l.includes(e)||l.push(e),$root.setAttribute("efy_shadow",l)}}))}),1)})),l!==[]&&$root.setAttribute("efy_shadow",l);let _=0;$ready("[efy_color]",(e=>{const t=`colors_${Date.now()}${_}`;_++;let[a,s,o,i,n,r,c,d,f]=[[],[],[],[],[],[],[],1,9];e.setAttribute("efy_tabs",t),$add("div",{class:"efy_tabs",efy_select:""},[],e),e.getAttribute("efy_color").replaceAll(", ",",").split(",").map(((e,t)=>{let a=e.split(" "),l=a[0];a[0].includes("lang:")&&(l=a[0].replace("lang:","")),s[t]=l,o[t]=a[1]||null,i[t]=a[2]||null,n[t]=a[3]||null,r[t]=a[4]||null,c[t]=a[5]||null}));const y=s[s.length-1],u=y.includes("range"),m=$$(e,".efy_tabs");u&&([d,f]=y.replace("range:","").split("-"),[s,o,i,n,r,c].map((e=>e.pop())));let h,p=s.length;const b=u?"":" efy_hide_i",g=u?null:{tabindex:"-1"};bg="background: linear-gradient(to right,",[["add","plus"],["remove","remove"]].map((e=>{$add("button",{class:`color_${e[0]}${b}`,...g},[["i",{efy_icon:e[1]}]],m)})),["copy","paste"].map((e=>$add("button",{class:`efy_${e}`,title:e},[["i",{efy_icon:e}]],m)));const v=$$(e,".color_add"),k=$$(e,".color_remove"),w=$$(e,".efy_copy"),A=$$(e,".efy_paste"),x=()=>{u&&(p<f?v.classList.remove("efy_hide_i"):v.classList.add("efy_hide_i"),p>d?k.classList.remove("efy_hide_i"):k.classList.add("efy_hide_i")),p>d?(w.classList.remove("efy_hide_i"),A.classList.remove("efy_hide_i")):0==p&&(w.classList.add("efy_hide_i"),A.classList.add("efy_hide_i"))};x();const E=(a,l)=>{for(let _=a;_<l;_++){const a=String(_+1),d=`oklch(${o[_]} ${i[_]} ${n[_]} / ${r[_]})`,f=[["hue","hue",360,1,n[_]],["saturation","chroma",.37,.01,i[_],`${bg} oklch(.5 0 0), ${d})`],["brightness","lightness",1,.01,o[_],`${bg} oklch(0 0 0), ${d}, oklch(1 0 0))`],["alpha","alpha",1,.01,r[_],`${bg} oklch(0 0 0 / 0), ${d})`]].map((e=>["div",{efy_lang:e[0],efy_range_text:e[0]},[["input",{class:e[1],type:"range",min:0,max:e[2],step:e[3],value:e[4],style:e[5]}]]])),y=c[_]||`${t}_${a}`,u=$add("div",{efy_content:a},[...f],e);$add("input",{id:y,efy_tab:a,type:"radio",name:t},[],v,"beforebegin"),$add("label",{for:y,style:`background: ${d}`},s[_]||l,v,"beforebegin"),["button","trans"].map((t=>{if(e.classList.contains(`efy_shadows_${t}`)){let[e,a,s,o,i]=[!1,0,0,0,0];const n=`efy_shadow_${t}_inset${_}`,r=[[],u,"afterbegin"];if(efy[`shadow_${t}`]){const n=efy[`shadow_${t}`][_]||efy[`shadow_${t}`][_-1];[e,a,s,o,i]=[n.inset,n.x,n.y,n.blur,n.spread]}$add("label",{efy_lang:"inset",for:n},...r),$add("input",{id:n,type:"checkbox",...e?{checked:!0}:{}},...r),[["x",a],["y",s]].map((e=>$add("div",{efy_range_text:e[0],efy_lang:e[0]},[["input",{class:e[0],type:"range",min:"-30",max:"30",value:e[1],step:"1"}]],u))),$add("div",{efy_range_text:"blur",efy_lang:"blur"},[["input",{class:"blur",type:"range",min:"0",max:"50",value:o,step:"1"}]],u),$add("div",{efy_range_text:"spread",efy_lang:"spread"},[["input",{class:"spread",type:"range",min:"-20",max:"30",value:i,step:"1"}]],u)}}))}};E(0,p),$event(m,"click",(t=>{let a,_,c,y,u,m;const b=t.target;x();const g=b.matches(".efy_copy"),v=b.matches(".efy_paste"),k=b.matches(".color_add"),w=b.matches(".color_remove");if(0!==p&&(_=$$(e,"[efy_content][efy_active]")||$$(e,"[efy_content]:last-of-type"),a=_.getAttribute("efy_content")-1),(g||v)&&([c,y,u,m]=[$$(_,".lightness"),$$(_,".chroma"),$$(_,".hue"),m=$$(_,".alpha")]),k&&p<f)p++,h=p-1,[s[h],o[h],i[h],n[h],r[h]]=[String(p),o[a],i[a],n[a],r[a]],0===p?(E(0,1),_=$$(e,"[efy_content]"),a=_.getAttribute("efy_content")):E(h,p),$$(e,"[efy_tab]:last-of-type").click();else if(g){const e=`${c.value} ${y.value} ${u.value} ${m.value}`;navigator.clipboard.writeText(e),0!=efy.notify_clipboard&&$notify("short","Copied to clipboard",e)}else if(v)navigator.clipboard.readText().then((e=>{[c.value,y.value,u.value,m.value]=e.split(" "),u.dispatchEvent(new Event("input",{bubbles:!0}))})).catch();else if(w&&p>d){$$all(e,"[efy_tab], [efy_content], input[type=radio][name*=colors], input[type=radio][name*=colors] + label").forEach((e=>e.remove())),[o,i,n,r].map((e=>e.splice(a,1))),p--,h=p-1,s=[];for(let e=1;e<=p;e++)s.push(String(e));if(E(0,p),0!==p){($$(e,`[efy_tab="${a+1}"]`)||$$(e,"[efy_tab]:last-of-type")).click()}else["button","trans"].map((t=>{e.classList.contains(`efy_shadows_${t}`)&&(l=l.filter((e=>e!==t)),$root.setAttribute("efy_shadow",l),delete efy[`shadow_${t}`],$save())}))}})),$event(e,"input",(t=>{let a=$$(e,"[efy_content]");const s=t.target;s.matches("[efy_tab]")&&($$all(e,"[efy_tab]").forEach((e=>e.removeAttribute("efy_active"))),$$all(e,"[efy_content]").forEach((e=>e.removeAttribute("efy_active"))),s.setAttribute("efy_active",""),$$(e,`[efy_content="${s.getAttribute("efy_tab")}"]`).setAttribute("efy_active","")),$$(e,"[efy_content][efy_active]")?a=$$(e,"[efy_content][efy_active]"):["tab","content"].map((t=>$$(e,`[efy_${t}]`).setAttribute("efy_active","")));const l=a.getAttribute("efy_content"),_=$$(e,`[efy_tab="${l}"] + label`),c=$$(a,".lightness").value,d=$$(a,".chroma").value,f=$$(a,".hue").value,y=$$(a,".alpha").value,u=`${c} ${d} ${f}`,m=[`.5 0 0), oklch(${c} ${d} ${f}))`,`0 0 0), oklch(.5 ${d} ${f}), oklch(1 0 0))`,`0 0 0 / 0), oklch(${c} ${d} ${f}))`];[".chroma",".lightness",".alpha"].map(((e,t)=>{$$(a,e).style.background="linear-gradient(to right, oklch("+m[t]})),_.style.background=`oklch(${u} / ${y})`,[o[l-1],i[l-1],n[l-1],r[l-1]]=[c,d,f,y],["text","bgcol","bordercol","buttoncol"].map((e=>{_.getAttribute("for")==`efy_color_${e}`&&($css_prop(`---color_${e}_var`,u),efy[e]=u,$save())}))}))})),(()=>{const e=$("#efy_sbtheme [efy_content=mode]"),t=[["div",{class:"defaults"}],["p",{efy_lang:"custom"}],["div",{class:"custom"}]];e.classList.add("efy_shadow_trans_off"),$add("div",{class:"current_mode efy_shadow_trans"},[["div",{class:"efy_mode_div"}],["div",{class:"efy_mode_type_div efy_hide_i"},[["details",{class:"system_light"},[["summary",{efy_lang:"light"}],...t]],["details",{class:"system_dark"},[["summary",{efy_lang:"dark"}],...t]],["input",{type:"checkbox",id:"system_theme_confirmation"}],["label",{for:"system_theme_confirmation",efy_lang:"confirm"}]]]],e)})(),"default switch_light switch_dark system".split(" ").map((e=>{const t=[[],$("#efy_sbtheme [efy_content=mode] .efy_mode_div")],a=`efy_mode_${e}`;e=e.replace("switch_",""),$add("input",{type:"radio",name:"efy_mode",id:a},...t),$add("label",{for:a,efy_lang:e},...t)})),$add("div",{class:"efy_hr_div"},[["details",{efy_help:"type",class:"efy_hide_i"},[["summary",[["p",{efy_lang:"type"}],["hr"]]],["div",{efy_lang:"sidebar_transparency_help"}]]]],$("#efy_sbtheme [efy_content=mode] .efy_mode_div"),"afterend"),"solid sepia nord black trans".split(" ").map((e=>{const t=[[],$("#efy_sbtheme .efy_mode_type_div")],a=[[],$("#efy_sbtheme .system_light .defaults")],s=[[],$("#efy_sbtheme .system_dark .defaults")];["_trans","light_","dark_"].forEach((t=>e=e.replace(new RegExp(t,"g"),"")));const o=`efy_mode_${e}`,i=`efy_mode_light_${e}`,n=`efy_mode_dark_${e}`;if($add("input",{type:"radio",name:"efy_mode_type",id:o},...t),$add("label",{for:o,efy_lang:e,class:"efy_hide_i"},...t),"solid"===e||"trans"===e){const t="solid"===e?{checked:""}:null;$add("input",{type:"radio",name:"efy_mode_system_light",id:i,...t},...a),$add("label",{for:i,efy_lang:e},...a),$add("input",{type:"radio",name:"efy_mode_system_dark",id:n,...t},...s),$add("label",{for:n,efy_lang:e},...s)}else"sepia"===e?($add("input",{type:"radio",name:"efy_mode_system_light",id:i},...a),$add("label",{for:i,efy_lang:e},...a)):($add("input",{type:"radio",name:"efy_mode_system_dark",id:n},...s),$add("label",{for:n,efy_lang:e},...s))})),$add("div",{class:"trans_window_div efy_hide_i"},[["input",{type:"checkbox",name:"trans_window",id:"trans_window"}],["label",{for:"trans_window",efy_lang:"window"}]],$("#efy_sbtheme [efy_content=mode] .efy_mode_type_div")),$add("div",{id:"efy_images_bg"},[["div",{class:"efy_hr_div"},[["details",{efy_help:"images"},[["summary",[["p",{efy_lang:"images"}],["hr"]]],["div",{efy_lang:"sidebar_images_warning_help"}]]]]],["div",{class:"efy_img_previews"},[["input",{id:"idb_addimg_bg",type:"file",accept:"image/*, video/*",style:"display: none"}],["label",{for:"idb_addimg_bg",title:"Add file",class:"efy_color",type:"button",role:"button"},[["i",{efy_icon:"plus"}]]],["input",{id:"idb_remove_toggle",type:"checkbox",style:"display: none"}],["label",{for:"idb_remove_toggle",title:"Remove",class:"efy_color",type:"button",role:"button"},[["i",{efy_icon:"remove"}]]],["button",{class:"efy_images_reset efy_hide_i",title:"reset"},[["i",{efy_icon:"reload"}]]]]]],$("#efy_sbtheme [efy_content=mode] .efy_mode_type_div"),"afterend");const c=$("#efy_sbtheme [efy_content=mode]");$add("details",{id:"efy_themes"},[["summary",{efy_lang:"saved_themes"},[["i",{efy_icon:"group"}]]],["hr"],["div",{class:"themes"},[["input",{type:"checkbox",id:"efy_theme_add",name:"efy_theme_add",class:"add efy_square_btn"}],["label",{for:"efy_theme_add",class:"add efy_square_btn",title:"Save"},[["i",{efy_icon:"arrow_down"}]]],["input",{type:"checkbox",id:"efy_theme_remove",name:"efy_theme_remove",class:"remove efy_square_btn"}],["label",{for:"efy_theme_remove",class:"remove efy_square_btn",title:"Remove"},[["i",{efy_icon:"remove"}]]],["input",{type:"checkbox",id:"efy_theme_edit",name:"efy_theme_edit",class:"edit efy_square_btn"}],["label",{for:"efy_theme_edit",class:"edit efy_square_btn",title:"Edit"},[["i",{efy_icon:"edit"}]]],["input",{type:"text",class:"name efy_square_btn efy_hide_i",placeholder:"Theme Name...",name:"efy_themes_name"}]]],["hr"],["p",["Find & Share more themes at ",["a",{href:"https://efy.ooo#themes"},"efy.ooo#themes"]]]],c);let d=0,f="",y="",u="";open_idb=(e="efy")=>new Promise(((t,a)=>{const s=indexedDB.open(e);s.onerror=e=>a("efy: Can't open db"),s.onsuccess=e=>{f=s.result,t(f),0===d&&m(f),d++},s.onupgradeneeded=e=>{const t=e.target.result;"bg settings themes themes_system front back button trans".split(" ").map((e=>{t.createObjectStore(e,{keyPath:"id",autoIncrement:!0})}))}}));const m=e=>{const t=e.transaction(["themes","themes_system"],"readonly");t.objectStore("themes").getAll().onsuccess=e=>{y=e.target.result,y.forEach((e=>h(e)))},t.objectStore("themes_system").getAll().onsuccess=e=>{u=e.target.result[0]}},h=e=>{const t=$("#efy_theme_edit"),a=$add("button",{"data-id":e.id,spellcheck:!1},e.name,$$(c,".themes"));$event(a,"click",(a=>{const s=a.target;$("#efy_theme_remove").checked?(p("remove",Number(s.getAttribute("data-id"))),s.remove()):t.checked||(localStorage.efy=e.info,location.reload())})),$event(a,"input",(e=>{const a=e.target;t.checked&&p("edit",Number(a.getAttribute("data-id")),a.textContent)})),$event(a,"keypress",(e=>{if(" "===e.key||32===e.keyCode){const t=window.getSelection(),a=t.getRangeAt(0),s=a.startContainer.textContent,o=a.startOffset;e.target.textContent=s.slice(0,o)+" "+s.slice(o);for(let e=0;e<o+1;e++)t.modify("move","forward","character")}})),$wait(.1,(()=>{f.transaction(["themes_system"],"readonly").objectStore("themes_system").getAll().onsuccess=t=>{const a=t.target.result[0];["light","dark"].map((t=>{const s=a[t]===e.name?{checked:"true"}:null,o=[e.name,$$(c,`.system_${t} .custom`)],i=`efy_mode_system_${t}_${e.name}`;$add("input",{type:"radio",id:i,name:`efy_mode_system_${t}`,...s},...o),$add("label",{for:i},...o)}))}}))},p=(e,t,a)=>{const s=f.transaction(["themes"],"readwrite").objectStore("themes");if("remove"===e)s.delete(t);else if("edit"===e)s.get(t).onsuccess=e=>{const t=e.target.result;t.name=a,s.put(t)};else{$$all(c,".themes [data-id]").forEach((e=>e.remove()));const e=localStorage.efy;s.add({name:t,info:e}).onsuccess=e=>m(f)}},b=e=>{f.transaction(["themes_system"],"readwrite").objectStore("themes_system").getAll().onsuccess=t=>{(e=>{const t=y.find((t=>t.name===e));(()=>{try{efy=JSON.parse(t.info),$save()}catch{const e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";["dark,black"].includes(u[e])&&$root.setAttribute("efy_mode","dark,black")}$save()})(),$("#system_theme_confirmation").checked&&$("#efy_mode_system").checked?$notify("infinite",`Set Theme to "${t.name}?"`,"The page will reload","",(e=>{$add("div",{class:"answers"},[["button",{class:"yes",efy_lang:"yes"},[["i",{efy_icon:"reload"}]]],["button",{class:"empty",efy_lang:"no"},[["i",{efy_icon:"remove"}]]]],e[0]),$event($$(e[0],".yes"),"click",(()=>{location.reload()}))})):$("#efy_mode_system").checked||location.reload()})(t.target.result[0][e])}};if($event($("#efy_themes .add"),"click",(e=>{const t=$("#efy_themes .name"),a=t.value;t.classList.toggle("efy_hide_i"),a&&(p("add",a),t.value=""),$notify("short","Add Themes - "+(e.target.checked?"ON":"OFF"))})),$event($("#efy_themes .edit"),"click",(e=>{const t=e.target.checked;$all("#efy_themes .themes > button").forEach((e=>e.contentEditable=t)),$notify("short","Rename Themes - "+(t?"ON":"OFF"),"")})),$event($("#efy_themes .remove"),"click",(e=>{$notify("short","Remove Themes - "+(e.target.checked?"ON":"OFF"))})),$event($('.efy_sidebar [efy_content="mode"]'),"click",(e=>{const t=e.target,a=(e,t)=>e.classList.toggle("efy_hide_i",t),s=".efy_mode_type_div :is(.system_light, .system_dark), [for=system_theme_confirmation]";if($("#efy_mode_default").checked&&($("#efy_mode_trans").checked=!1),$all("[for=efy_mode_sepia]").forEach((e=>{a(e,!$("#efy_mode_switch_light").checked)})),$all("[for=efy_mode_solid], [for=efy_mode_nord], [for=efy_mode_black]").forEach((e=>{a(e,!$("#efy_mode_switch_dark").checked)})),$all("[efy_help=type], [for=efy_mode_solid], [for=efy_mode_trans], .efy_mode_type_div").forEach((e=>{a(e,!($("#efy_mode_switch_light").checked||$("#efy_mode_switch_dark").checked))})),$("#efy_mode_system").checked){const e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";$root.setAttribute("efy_mode",e),$("#efy_mode_trans").checked=!1,$all(`.efy_mode_type_div, ${s}`).forEach((e=>e.classList.remove("efy_hide_i")))}else $all(s).forEach((e=>e.classList.add("efy_hide_i")));$all("#efy_sbtheme .defaults label").forEach((e=>{a(e,!$("#efy_mode_system").checked)})),(t.matches("#efy_mode_switch_light")||t.matches("#efy_mode_switch_dark"))&&($("#efy_mode_solid").checked=!0),a($("#efy_mode_trans"),!$(".trans_window_div").checked),a($(".trans_window_div"),!$("#efy_mode_trans").checked),a($("#efy_images_bg"),$("#trans_window").checked)})),efy.mode){let e=efy.mode;const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";$wait(.1,(()=>{const a=f.transaction(["themes_system"],"readwrite").objectStore("themes_system");a.getAll().onsuccess=s=>{const o=s.target.result[0],i=()=>{e=t,b(e),o.changed=e,a.put(o)};!0===o.status&&($("#efy_mode_system").click,$("#efy_mode_system").dispatchEvent(new Event("click",{bubbles:!0})),o.changed!==t&&i()),$("#system_theme_confirmation").checked=o.confirm,e.includes("system")&&i()}})),$root.setAttribute("efy_mode",e);const a=e.replace("dark,","").replace("light,","");try{e.includes("default")?$("#efy_mode_"+e).checked=!0:["light","dark"].some((t=>e.includes(t)))&&($("#efy_mode_switch_"+e).checked=!0,$("#efy_mode_switch_"+e).dispatchEvent(new Event("click",{bubbles:!0}))),["sepia","nord","black","trans"].some((e=>a.includes(e)))&&($("#efy_mode_"+a).checked=!0),a.includes("trans")&&$("#efy_mode_"+a).dispatchEvent(new Event("click",{bubbles:!0})),!0===efy.trans_window&&($("#trans_window").checked=!0)}catch{alert(e)}}else $root.setAttribute("efy_mode","default"),$("#efy_mode_default").setAttribute("checked","");$wait(.2,(()=>{const e=f.transaction(["themes_system"],"readwrite").objectStore("themes_system");e.getAll().onsuccess=t=>{const a=t.target.result;Array.isArray(a)&&0===a.length&&e.add({light:"light",dark:"dark",status:!1,confirm:!0})}})),$event($("#efy_mode_system"),"change",(e=>{$notify("long","WARNING - Unstable Experiment",'Toggle off "Confirm Changes" if it breaks');const t=f.transaction(["themes_system"],"readwrite").objectStore("themes_system");t.getAll().onsuccess=a=>{const s=a.target.result[0];s.status=e.target.checked,s.confirm=$("#system_theme_confirmation").checked,t.put(s)}})),$event($("#system_theme_confirmation"),"change",(e=>{const t=f.transaction(["themes_system"],"readwrite").objectStore("themes_system");t.getAll().onsuccess=e=>{const a=e.target.result[0];a.confirm=$("#system_theme_confirmation").checked,t.put(a)}}));const g=":is(.efy_mode_div, .efy_mode_type_div) > input";$all(g).forEach((e=>{$event(e,"change",(()=>{let e=[];if($all(`:is(${g}):checked`).forEach((t=>e.push(t.id.replace("efy_mode_","").replace("switch_","")))),e=String(e),e=[["default","default"],[",solid",e.replace(",solid","")],["light,nord","light"],["light,black","light"],["dark,sepia","dark"]].find((([t])=>e.includes(t)))?.[1]||e,e.includes("system")){const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";b(t),e=t}$root.setAttribute("efy_mode",e),efy.mode=e,$save()}))})),$event(window.matchMedia("(prefers-color-scheme: dark)"),"change",(e=>{!0===u.active&&b(e.matches?"dark":"light")})),["light","dark"].map((e=>{$event($(`.system_${e}`),"change",(t=>{const a=t.target;if(a.matches("input")){const t=f.transaction(["themes_system"],"readwrite").objectStore("themes_system");t.getAll().onsuccess=s=>{const o=s.target.result[0];o[e]=a.id.replace("efy_mode_","").replace(`system_${e}_`,"").replace("_",",").replace(",solid",""),t.put(o);const i=o[e];(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")===e&&("light light,sepia light,trans dark dark,nord dark,black dark,trans".split(" ").includes(i)?($root.setAttribute("efy_mode",i),efy.mode=i,$save()):b(e))}}}))})),efy.trans_window&&(e=efy.trans_window,$root.classList.add("trans_window"),$("#trans_window").setAttribute("checked","")),$event($("#trans_window"),"change",(()=>{$root.classList.toggle("trans_window"),efy.trans_window=$("#trans_window").checked,$save()})),e=$("#efy_sbtheme [efy_content=size]"),$add("div",{efy_lang:"radius",efy_range_text:"Radius"},[["input",{class:"efy_radius_input",type:"range",min:"0",max:"25",value:"12",step:"1"}]],e),$add("div",{efy_lang:"border",efy_range_text:"Border"},[["input",{class:"efy_border_size_input",type:"range",min:"0",max:"8",value:"1.5",step:"0.1"}]],e),$add("div",{efy_lang:"gap",efy_range_text:"Gap alpha"},[["input",{class:"efy_gap_input",type:"range",min:"0",max:"30",value:"15",step:"1"}]],e),$add("div",{efy_lang:"max_width",efy_range_text:"Max Width alpha"},[["div",{class:"efy_max_width_div"},[["input",{class:"efy_maxwidth_input",type:"range",min:"500",max:"5000",value:"1200",step:"1"}],["select",{name:"efy_name"},[["option",{value:"rem"},"REM"],["option",{value:"%"},"%"]]]]]],e),e=["radius","border_size","gap","color_angle"];let v=["rem","rem","rem","deg"];e.forEach(((e,t)=>{let a=efy[e],s=$(`.efy_${e}_input`);a&&(s.value=a.replace(v[t],""),$css_prop(`---${e}`,a)),$event(s,"input",(()=>{let a=s.value+v[t];$css_prop(`---${e}`,a),efy[e]=a,$save()}))}));let k,w=$(".efy_maxwidth_input"),A='[efy_range_text*="Max Width"] select',x=$(A),E=efy.max_width;E?(k=E.replace("rem","").replace("%",""),w.value=k,$css_prop("---body_width",E)):k=1200,w.oninput=()=>{let e=w.value;x=$(A).value,$css_prop("---body_width",e+x),efy.max_width=e+x,$save()},x.oninput=()=>{"%"==x.value&&(w.setAttribute("min","10"),w.setAttribute("max","100"),w.setAttribute("value","100")),"rem"==x.value&&(w.setAttribute("min","500"),w.setAttribute("max","5000"),w.setAttribute("value","1200"));let e=w.value;x=$(A).value,$css_prop("---body_width",e+x),efy.max_width=e+x,$save()};const S=$("#efy_sbtheme [efy_content=menu]");$add("details",{id:"efy_btn_align",efy_select:""},[["summary",{efy_lang:"button_position"}],["div"]],S),$add("details",{id:"efy_sidebar_align",efy_select:""},[["summary",{efy_lang:"menu"}],["div"]],S),["left","right"].map((e=>{const t=`efy_sidebar_align_${e}`,a=$("#efy_sidebar_align > div");$add("input",{type:"radio",name:"efy_sidebar_align",id:t},[],a),$add("label",{for:t,efy_lang:e},[],a)}));let L=efy.sidebar_align||"right";efy.sidebar_align&&$root.setAttribute("efy_sidebar",L),$(`#efy_sidebar_align_${L}`).setAttribute("checked",""),$all("[name=efy_sidebar_align]").forEach((e=>{const t=e.id.replace("efy_sidebar_align_","");$event(e,"click",(()=>{const e=$root.getAttribute("efy_sidebar").includes("on")?"on_":"";$root.setAttribute("efy_sidebar",e+t),efy.sidebar_align=t,$save()}))})),"left_top middle_top right_top left_middle middle_middle right_middle left_bottom middle_bottom right_bottom".split(" ").map((e=>{const t=$add("input",{type:"radio",name:"efy_btn_align",id:e},[],$("#efy_btn_align > div"));"middle_middle"==e&&t.setAttribute("disabled","")})),$wait(.1,(()=>{let e=$css_prop("---sidebar_button").replaceAll(" ","").split(","),a="efy_sidebar_btn_hide",s=$("#efy_btn_align"),o="beforeend",i=$("[efy_sidebar_btn*=absolute]");if($add("input",{type:"checkbox",name:a,id:a,checked:""},[],s,o),$add("label",{for:a,efy_lang:"floating_button"},[],s,o),!efy.sidebar_btn_status&&e.includes("off")&&(i.classList.add("efy_hide_i"),$("#"+a).removeAttribute("checked")),$event($("#"+a),"click",(()=>{i.classList.contains("efy_hide_i")?(efy.sidebar_btn_status="on",$save()):(delete efy.sidebar_btn_status,$save()),i.classList.toggle("efy_hide_i")})),a=$("[efy_sidebar_btn=absolute]"),t="efy_btn_align",efy.btn_align){let e=efy.btn_align;$("#"+e).setAttribute("checked",""),a.setAttribute(t,e)}else{let s=e[0];$("#"+s).setAttribute("checked",""),a.setAttribute(t,s)}$all("[name=efy_btn_align]").forEach((e=>{e.onclick=()=>{a.setAttribute(t,e.id),efy.btn_align=e.id,$save()}})),$event($body,"click",(()=>{let t=event.target;if(t.matches("[efy_sidebar_btn]")){let e="on";if(t.matches("[efy_sidebar_btn*=absolute]")&&a.classList.toggle("efy_hide_i"),$root.hasAttribute("efy_sidebar")){let t=$root.getAttribute("efy_sidebar"),a="";["left","right"].some((e=>t.includes(e)))&&(a=t.replace("on_","")),e=t.includes("on")?a:"on_"+a,$('.efy_sidebar [efy_sidebar_btn="close"]').focus()}$root.setAttribute("efy_sidebar",e)}t.matches(".efy_sidebar [efy_sidebar_btn*=close]")&&((e.includes("on")||"on"===efy.sidebar_btn_status)&&a.classList.toggle("efy_hide_i"),$wait(1,(()=>$("body [efy_sidebar_btn]:not(.efy_sidebar [efy_sidebar_btn])").focus())))}))})),$add("details",{id:"efy_notifications",efy_select:""},[["summary",{efy_lang:"notifications"},[["mark",{efy_lang:"alpha"}]]],["div",{id:"efy_notify_status"}],["p","Position"],["div",{id:"efy_notify_align"}]],$("#efy_sbtheme [efy_content=menu]")),"Offline Clipboard".split(" ").map((e=>{let t=`notify_${e.toLowerCase()}`,a=$("#efy_notifications #efy_notify_status");$add("input",{type:"checkbox",name:"efy_notify_status",id:e,checked:""},[],a),$add("label",{for:e},e,a);let s=$$(a,`#${e}`);0==efy[t]&&s.removeAttribute("checked"),$event(s,"change",(()=>{efy[t]=s.checked,$save()}))})),$ready("[efy_alerts]",(()=>{let e=$("[efy_alerts]"),t=$("#efy_notify_align");"left_top middle_top right_top left_bottom middle_bottom right_bottom".split(" ").map((a=>{$add("input",{type:"radio",name:"efy_notify_align",id:`notify_${a}`},[],t),$event($$(t,`#notify_${a}`),"change",(()=>{"left_top"==a?delete efy.notify_align:efy.notify_align=a,e.setAttribute("efy_alerts",a),$save()}))})),efy.notify_align&&e.setAttribute("efy_alerts",efy.notify_align),(efy.notify_align?$$(t,`#notify_${efy.notify_align}`):$$(t,"#notify_left_top")).checked=!0}),1),["bg","front","back"].map((e=>{let t=`efy_css_${e}`;$add("style",{class:t},[],$head),efy_css[e]=$("."+t),$event($body,"change",(t=>{t.target.matches(`#idb_addimg_${e}`)&&C(e,t)}))})),["quick","filters","audio",["accessibility",["virtual_keyboard","click_effects"]],"languages","backup","gamepads"].map((e=>{let[t,a]=Array.isArray(e)?e:[e,!1];efy.modules.includes(`efy_${t}`)&&($add("script",{src:`${efy.folder}/module_${t}.js`},[],$head),"gamepads"===t&&$add("link",{href:`${efy.folder}/module_${t}.css`,rel:"stylesheet"},[],$head)),a&&a.map((e=>{efy.modules.includes(`efy_${e}`)&&($add("link",{href:`${efy.folder}/module_${e}.css`,rel:"stylesheet"},[],$head),$add("script",{src:`${efy.folder}/module_${e}.js`},[],$head))}))})),$ready("[efy_upload]",(e=>{let t,a=e.getAttribute("efy_upload"),s=a.match(/\[(.*?)\]/),o=a.replaceAll(" ","").split(","),i="plus";s?(t=s[1],o=a.replace(`[${t}],`,",").replaceAll(" ","").split(",")):t=o[1],o[2]?"small"!==o[2]&&e.setAttribute("efy_lang",o[2]):e.setAttribute("efy_lang","add_file"),o[4]&&(i=o[4]),e.setAttribute("role","button"),$add("input",{type:"file",id:o[0],accept:t},[],e),$add("i",{efy_icon:i},[],e),"multiple"==o[3]&&$all(`#${o[0]}`).forEach((e=>{e.setAttribute("multiple","")}))}));const C=async(e,t)=>{let a=await open_idb(),s=new FileReader;s.readAsDataURL(t.target.files[0]),s.onload=t=>{let o,i=s.result,n=new Image,r="efy_temp_canvas";n.onload=()=>{$add("canvas",{id:r},[],$(`#efy_images_${e} .efy_img_previews`));let t=$(`#${r}`);t.width=n.width/n.height*80,t.height=80,t.getContext("2d").drawImage(n,0,0,t.width,t.height),o=$(`#${r}`).toDataURL("image/webp"),t.remove(),a.transaction([e],"readwrite").objectStore(e).add({image:i,thumbnail:o}).onerror=e=>{console.error(e)}},n.src=i,(async()=>{let t=indexedDB.open("efy");t.onsuccess=()=>{let a=0,s=t.result.transaction([e],"readonly").objectStore(e).openCursor();s.onerror=()=>console.error("efy: no db entries"),s.onsuccess=t=>{let s=t.target.result;if(s)a++,s.continue();else{efy[`nr_${e}`]=a,$save();const t=`#efy_images_${e} .efy_img_previews`;$text(efy_css[e],`.efy_3d_${e} {background: url(${i})!important; background-size: var(---bg_size)!important} html {background: var(---text2)!important}`),$add("button",{efy_bg_nr:a,style:`background: url(${o})`},[],$(t));const s=$(`${t} [efy_bg_nr="${a}"]`);$all(`${t} [efy_bg_nr]`).forEach((e=>e.removeAttribute("efy_active"))),s.setAttribute("efy_active",""),$event(s,"click",(()=>{$text(efy_css[e],`.efy_3d_${e} {background: url(${i})!important; background-size: var(---bg_size)!important} html {background: var(---text2)!important}`),efy[`nr_${e}`]=a,$save(),$all(`${t} [efy_bg_nr]`).forEach((e=>e.removeAttribute("efy_active"))),s.setAttribute("efy_active","")})),i.includes("video")&&($(`.efy_3d_${e}`).setAttribute("src",i),$(`.efy_3d_${e}`).volume=0,$event(document,"visibilitychange",(()=>{let t=$(`.efy_3d_${e}`);document.hidden?t.pause():t.play()})))}}}})()}},q=async e=>{let t=0;const a=(await open_idb("efy")).transaction([e],"readonly").objectStore(e),s=a.openCursor();let o=0;s.onsuccess=s=>{const i=s.target.result;if(i){o++;const a=i.value,s=`#efy_images_${e} .efy_img_previews`,n=o;efy[`nr_${e}`]==n&&(t=a.id),$add("button",{efy_bg_nr:a.id,style:`background: url(${a.thumbnail})`,efy_audio_mute:"ok"},[],$(s)),$event($(`${s} [efy_bg_nr="${a.id}"]`),"click",(t=>{$text(efy_css[e],`.efy_3d_${e} {background: url(${a.image})!important; background-size: var(---bg_size)!important} html {background: var(---text2)!important; background-size: cover!important}`),efy[`nr_${e}`]=n,$save(),$all(`${s} [efy_bg_nr]`).forEach((e=>e.removeAttribute("efy_active"))),t.target.setAttribute("efy_active","")})),i.continue()}else o>0&&(a.get(t).onsuccess=t=>{$text(efy_css[e],`.efy_3d_${e} {background: url(${t.target.result.image})!important; background-size: var(---bg_size)!important}`),$(`#efy_images_${e} .efy_img_previews [efy_bg_nr]:nth-of-type(${efy[`nr_${e}`]+1})`).setAttribute("efy_active","")}),$all(".efy_images_reset").forEach((e=>{$event(e,"click",(()=>{f.transaction(["bg"],"readwrite").objectStore("bg").clear().onsuccess=e=>{$all(".efy_img_previews [efy_bg_nr]").forEach((e=>e.remove()))}}))}))},s.onerror=()=>console.error("efy: no db entries")},j=$(".efy_img_previews");$event(j,"click",(e=>{if(e.target.matches(".efy_remove [efy_bg_nr]")){const t=e.target,a=Number(t.getAttribute("efy_bg_nr"));indexedDB.open("efy").onsuccess=e=>{e.target.result.transaction(["bg"],"readwrite").objectStore("bg").delete(a),t.remove()}}else if(e.target.matches("#idb_remove_toggle")){j.classList.toggle("efy_remove"),$(".efy_images_reset").classList.toggle("efy_hide_i");const t=e.target.checked;$notify("short",t?"Remove Media":"Set Background",t?"Select what to remove":"Select your background")}})),(async()=>{await q("bg"),efy.modules.includes("efy_filters")&&(await q("front"),q("back"))})(),$ready("[efy_tabs]",(e=>{$event(e,"click",(e=>{const t=e.target;if(!t.matches("[efy_tab]"))return;e.stopPropagation();const a=`[efy_tabs="${t.closest("[efy_tabs]").getAttribute("efy_tabs")}"]`,s=t.hasAttribute("efy_active"),o=`:is(${a}, ${a} > div, ${a} > div > div) >`,i=$(`${o} [efy_content="${t.getAttribute("efy_tab")}"]`),n=(e,t)=>e[t?"removeAttribute":"setAttribute"]("efy_active","");$all(`${o} :is([efy_tab], [efy_content])[efy_active]`).forEach((e=>n(e,!0))),[t,i].forEach((e=>n(e,s)))}))})),$ready("[efy_code]",(e=>{let t=e.getAttribute("efy_code").split(",");$add("div",{class:"efy_bar"},[["mark",t[0]],["div",[["button",{class:"efy_code_trans"},"transparent"],["button",{class:"efy_fs"},[["i",{efy_icon:"fullscreen"}]]],["button",{class:"efy_copy"},[["i",{efy_icon:"copy"}]]]]]],e,"afterbegin"),$event(e,"click",(t=>{if((t=t.target).matches(".efy_fs"))document.fullscreenElement?document.exitFullscreen():e.requestFullscreen();else if(t.matches(".efy_code_trans"))$body.classList.toggle("efy_code_trans_on");else if(t.matches(".efy_copy")){let t=e.textContent.replace($$(e,".efy_bar").textContent,"");navigator.clipboard.writeText(t),0!=efy.notify_clipboard&&$notify("short","Copied to clipboard",t)}}))})),$ready("[efy_range_text]",(e=>{const t=$$(e,"input[type=range]"),a=$add("input",{class:"efy_range_text_p",type:"number",value:t.value,step:t.step,min:t.min,max:t.max,name:"efy_name"},[],e,"afterbegin");t.setAttribute("aria-hidden",""),t.setAttribute("tabindex","-1"),$event(a,"input",(e=>{t.value=e.target.value,t.dispatchEvent(new Event("input",{bubbles:!0}))})),$event(t,"input",(e=>a.value=e.target.value))})),$all("form[class*=efy]").forEach((e=>{$event(e,"reset",(()=>{$$all(e,"[efy_range_text]").forEach((e=>{$$(e,".efy_range_text_p").value=$$(e,"input").value}))}))}));let M=e=>(e<10&&(e="0"+e),e),T=()=>{let e=new Date,t=e.getHours(),a=M(e.getMinutes()),s="";$all("[efy_clock]").forEach((o=>{let i="";o.getAttribute("efy_clock").includes("12")&&(i=t<12?" AM":" PM"),o.getAttribute("efy_clock").includes("hms")&&(s=M(e.getSeconds()));let n="hour s1 minute s2 second format".split(" ");[t,":",a,":",s,i].map(((e,t)=>{$$(o,"."+n[t]).textContent=e}))}))};$ready("[efy_clock]",(e=>{"hour s1 minute s2 second format".split(" ").map((t=>{$add("p",{class:t},[],e)})),$wait(.1,T),setInterval(T,1e3)})),$ready("[efy_timer]",(e=>{let t=e.getAttribute("efy_timer").replaceAll(" ","").split(","),a="00:00:00";void 0!==t[1]&&(a=$sec_time(t[1])),$add("div",{efy_text:""},[a],e),$add("button",{efy_start:"",title:"Start or Pause"},[],e),$add("button",{efy_reset:"",title:"Reset"},[],e);let s,o=$$(e,"[efy_start]"),i=$$(e,"[efy_reset]"),n=$$(e,"[efy_text]"),r=0;const l=()=>{clearInterval(s),r=0,"reverse"==t[2]?$text(n,$sec_time(t[1])):$text(n,"00:00:00"),o.removeAttribute("efy_active")};$event(o,"click",(()=>{clearInterval(s),o.toggleAttribute("efy_active"),o.hasAttribute("efy_active")?s=setInterval((()=>{"reverse"==t[2]?(r++,$text(n,$sec_time(t[1]-r))):(r++,$text(n,$sec_time(r))),r==t[1]&&($notify("infinite","Done!","Time is up!"),$audio_play(efy_audio.call,"loop"),l(),$event($("[efy_alert]"),"click",(()=>{try{efy_audio.call.pause()}catch{}})))}),1e3):clearInterval(s)})),$event(i,"click",l)})),$ready("[efy_search]",(e=>{let t=e,a=t.getAttribute("efy_search"),s=`#${t.id}[efy_search="${a}"]`,o=$(s+" [efy_search_input]");$event(o,"input",(()=>{let e=o.value.toLowerCase();$all(s+" "+a).forEach((t=>{t.textContent.toLowerCase().includes(e)||t.title.toLowerCase().includes(e)?t.classList.remove("efy_hide_i"):t.classList.add("efy_hide_i")}))}))})),$ready("[efy_toggle]",(e=>{let t=e.getAttribute("efy_toggle");$event(e,"click",(()=>{$all(t).forEach((e=>{e.classList.toggle("efy_hide_i"),e.classList.contains("efy_hide_i")?e.setAttribute("tabindex","-1"):e.removeAttribute("tabindex")}))}))})),$add("div",{efy_alerts:"",class:"efy_sidebar_width"},[],$body,"afterbegin"),$event($body,"pointerup",(()=>{let e=event.target;if(e.matches("[efy_alert]")){let t=e.classList[0],a=()=>{let e=$all(".efy_quick_notify_content [efy_alert]").length>0?"_active":"";$(".efy_quick_notify i").setAttribute("efy_icon","notify"+e)};e.classList.add("efy_anim_remove"),$wait(.05*$css_prop("---anim_speed"),(()=>{e.remove();try{$(`.efy_quick_notify_content [efy_alert].${t}`).remove(),clearInterval(efy_timer_interval)}catch{}a()}))}})),$add("i",{efy_lang:"no_notifications",style:"opacity: 0; pointer-events: none; position: absolute"},[],$(".efy_sidebar")),$all('input[type="range"], .plus-btn, .minus-btn').forEach((e=>$event(e,"contextmenu",(()=>event.preventDefault())))),$(".efy_lang_app_file").onload=()=>{const e=new WeakSet;new MutationObserver((t=>{for(let a of t)"childList"===a.type&&($$all(a.target,"[efy_lang]").forEach((t=>{if(!e.has(t)){const a=getComputedStyle($("[efy_lang]")).getPropertyValue(`--${t.getAttribute("efy_lang")}`);t.insertAdjacentText($$(t,"[efy_icon]")?"beforeend":"afterbegin",t.hasAttribute("efy_range_text")?`${a}:`:a),e.add(t)}})),a.removedNodes.forEach((t=>{1===t.nodeType&&e.delete(t)})))})).observe(document.body,{childList:!0,subtree:!0}),['"Max Width"'].map((e=>{$add("mark",{efy_lang:"alpha"},[],$(`[efy_content=size] [efy_range_text*=${e}] .efy_range_text_p`),"afterend")})),$add("style",`.efy_quick_notify_content:empty:before {content: '${efy_lang.no_notifications}'}`,$head),["offline","online"].map(((e,t)=>{$event(window,e,(()=>{if(!1!==efy.notify_offline){const t=["",$("[efy_lang]")],a=`--${e}_notify`;$notify("short",$css_prop(a,...t),$css_prop(`${a}_text`,...t))}}))}))},$event(document,"keydown",(()=>{const e=event.target,t=event.key,a="ArrowUp"===t||"ArrowLeft"===t;if((e.matches('input[type="radio"]')||e.matches('input[type="checkbox"]'))&&(a||"ArrowDown"===t||"ArrowRight"===t)){event.preventDefault();const t=Array.from($all(`[name="${e.name}"]`));let s=t.indexOf(e)+(a?-1:1);s<0&&(s=t.length-1),s>=t.length&&(s=0),t[s].focus()}}),!1),$event(document,"keyup",(()=>{const e=event.target,t=event.key;" "!==t&&"Enter"!==t||!e.matches("input[efy_tab]")&&!e.matches("button")||(event.preventDefault(),e.dispatchEvent(new Event("click",{bubbles:!0})),e.focus())}),!1)};